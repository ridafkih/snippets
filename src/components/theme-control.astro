---
import ThemeControlIllustration from "./theme-control-illustration.astro";
---

<div class="theme-control">
  <input type="radio" name="theme" id="light" checked />
  <label for="light">
    <ThemeControlIllustration />
    <span>Light</span>
  </label>

  <input type="radio" name="theme" id="dark" />
  <label for="dark">
    <ThemeControlIllustration variant="dark" />
    <span>Dark</span>
  </label>

  <input type="radio" name="theme" id="system" />
  <label for="system">
    <ThemeControlIllustration variant="system" />
    <span>System</span>
  </label>
</div>

<style>
  .theme-control {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  input[type="radio"] {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }

  label {
    --color-outline: transparent;
    --color-label: var(--color-light-mode-text);

    width: fit-content;
    cursor: pointer;
    padding: 0.625rem;
    border-radius: 1rem;

    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 0.625rem;

    outline: 0.125rem solid var(--color-outline);
    color: var(--color-label);

    transition: 0.12s outline ease;
  }

  input[type="radio"]:checked + label {
    --color-outline: var(--color-highlight);
    --color-label: var(--color-highlight);

    background: color-mix(in srgb, var(--color-outline) 10%, transparent);

    .illustration {
      filter: drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.05));
    }
  }

  input[type="radio"]:focus-visible + label {
    --color-outline: var(--color-highlight);
    --color-label: var(--color-highlight);
  }

  @media screen and (min-width: 24rem) {
    .theme-control {
      flex-direction: row;
    }
  }
</style>

<script>
  const radios = document.querySelectorAll<HTMLInputElement>(
    'input[name="theme"]',
  );
  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)");

  const applyTheme = (theme: string) => {
    if (theme === "dark") {
      document.body.dataset.theme = "dark";
    } else if (theme === "system") {
      document.body.dataset.theme = prefersDark.matches ? "dark" : "light";
    } else {
      document.body.dataset.theme = "light";
    }
  };

  radios.forEach((radio) => {
    radio.addEventListener("change", () => {
      if (radio.checked) applyTheme(radio.id);
    });
  });

  prefersDark.addEventListener("change", () => {
    const systemRadio = document.querySelector<HTMLInputElement>("#system");
    if (systemRadio?.checked) applyTheme("system");
  });

  const checked = document.querySelector<HTMLInputElement>(
    'input[name="theme"]:checked',
  );
  if (checked) applyTheme(checked.id);
</script>
