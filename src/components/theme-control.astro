---
import ThemeControlIllustration from "./theme-control-illustration.astro";
---

<div class="theme-control">
  <input type="radio" name="theme" id="light" checked />
  <label for="light">
    <ThemeControlIllustration />
    <span>Light</span>
  </label>

  <input type="radio" name="theme" id="dark" />
  <label for="dark">
    <ThemeControlIllustration variant="dark" />
    <span>Dark</span>
  </label>

  <input type="radio" name="theme" id="system" />
  <label for="system">
    <ThemeControlIllustration variant="system" />
    <span>System</span>
  </label>
</div>

<style>
  .theme-control {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  input[type="radio"] {
    position: absolute;
    opacity: 0;
    pointer-events: none;
  }

  label {
    --color-outline: transparent;
    --color-label: var(--color-light-mode-text);
    --outline-width: 0.125rem;

    position: relative;
    width: fit-content;
    cursor: pointer;
    padding: 0.625rem;

    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 0.625rem;

    &::before {
      content: "";
      position: absolute;
      inset: 0;
      opacity: 0;
      transform: scale(0.99);
      outline: var(--outline-width) solid var(--color-highlight);
      border-radius: 1rem;
      background: color-mix(
        in srgb,
        var(--color-highlight) var(--color-highlight-mix-percentage),
        transparent
      );
      transition: 0.16s ease;
    }
  }

  input[type="radio"]:checked + label {
    --color-label: var(--color-highlight);

    color: var(--color-label);

    &::before {
      opacity: 1;
      transform: scale(1);
    }

    .illustration-filter {
      filter: drop-shadow(0px 2px 2px rgba(0, 0, 0, 0.05));
    }
  }

  input[type="radio"]:focus-visible + label {
    --outline-width: 0.1875rem;
  }

  @media screen and (min-width: 36rem) {
    .theme-control {
      flex-direction: row;
    }
  }
</style>

<script>
  const radios = document.querySelectorAll<HTMLInputElement>(
    'input[name="theme"]',
  );
  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)");

  const applyTheme = (theme: string) => {
    if (theme === "dark") {
      document.body.dataset.theme = "dark";
    } else if (theme === "system") {
      document.body.dataset.theme = prefersDark.matches ? "dark" : "light";
    } else {
      document.body.dataset.theme = "light";
    }
  };

  radios.forEach((radio) => {
    radio.addEventListener("change", () => {
      if (radio.checked) applyTheme(radio.id);
    });
  });

  prefersDark.addEventListener("change", () => {
    const systemRadio = document.querySelector<HTMLInputElement>("#system");
    if (systemRadio?.checked) applyTheme("system");
  });

  const checked = document.querySelector<HTMLInputElement>(
    'input[name="theme"]:checked',
  );
  if (checked) applyTheme(checked.id);
</script>
